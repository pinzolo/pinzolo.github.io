<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>さくらVPSの Ubuntu12.04 を 14.04 にした | tail -f pinzo.log</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="さくらVPSの Ubuntu12.04 を 14.04 にした" />
<meta name="author" content="pinzolo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="さくらVPSにログインするとアップグレードできるよって通知が出ていたので、14.04 にアップグレードしやした。 盛大にハマった…." />
<meta property="og:description" content="さくらVPSにログインするとアップグレードできるよって通知が出ていたので、14.04 にアップグレードしやした。 盛大にハマった…." />
<link rel="canonical" href="http://localhost:4000/2014/09/11/upgrade-ubuntu-to-1404-on-sakura-vps.html" />
<meta property="og:url" content="http://localhost:4000/2014/09/11/upgrade-ubuntu-to-1404-on-sakura-vps.html" />
<meta property="og:site_name" content="tail -f pinzo.log" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-09-11T11:40:00+09:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2014/09/11/upgrade-ubuntu-to-1404-on-sakura-vps.html","headline":"さくらVPSの Ubuntu12.04 を 14.04 にした","dateModified":"2014-09-11T11:40:00+09:00","datePublished":"2014-09-11T11:40:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2014/09/11/upgrade-ubuntu-to-1404-on-sakura-vps.html"},"author":{"@type":"Person","name":"pinzolo"},"description":"さくらVPSにログインするとアップグレードできるよって通知が出ていたので、14.04 にアップグレードしやした。 盛大にハマった….","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="tail -f pinzo.log" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">tail -f pinzo.log</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">さくらVPSの Ubuntu12.04 を 14.04 にした</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-09-11T11:40:00+09:00" itemprop="datePublished">Sep 11, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">pinzolo</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>さくらVPSにログインするとアップグレードできるよって通知が出ていたので、14.04 にアップグレードしやした。
盛大にハマった….</p>

<h2 id="コマンド叩く">コマンド叩く</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="k">do</span><span class="nt">-release-upgrade</span>
The upgrade has aborted. The upgrade needs a total of 55.6 M free
space on disk <span class="s1">'/boot'</span><span class="nb">.</span> Please free at least an additional 12.7 M of
disk space on <span class="s1">'/boot'</span><span class="nb">.</span> Empty your trash and remove temporary packages
of former installations using <span class="s1">'sudo apt-get clean'</span><span class="nb">.</span> 
</code></pre></div></div>

<p>いきなり容量が足りないときた。
<code class="highlighter-rouge">/boot</code>以下のファイルのうち、最新バージョン以外を削除して再度実行すればOKだった。
何度か、設定ファイルなどを最新のに上書きするかい？って聞かれるけど、おこのみで。
しないほうが無難だとは思う。</p>

<h2 id="バージョンの確認divgit-はソースから入れた-210-のまま">バージョンの確認&lt;div&gt;git はソースから入れた 2.1.0 のまま。</h2>

<p><a href="http://blog.mkt-sys.jp/2014/05/sakura-vps-ubuntu-to-1204-from-1204.html">前回と同じく</a>Rubyはリポジトリのものに置き換えられて 1.9.3 になっていたので入れ替えた。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mv</span> /usr/bin/erb<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/gem<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/irb<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/rake<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/rdoc<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/ri<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/ruby<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">mv</span> /usr/bin/testrb<span class="o">{</span>,.bak<span class="o">}</span>
<span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-sfn</span> /opt/ruby/ruby-2.1.2/bin/<span class="k">*</span> /usr/bin
</code></pre></div></div>

<p>ようやく Ubuntu でも 1.9.3 がデフォルトになったのか。めでたい。</p>

<h2 id="passengerのアップデート">Passengerのアップデート</h2>

<p>Apacheのバージョンが上がったので、Passenger も再インストール。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gem <span class="nb">install </span>passenger
<span class="nv">$ </span>/opt/ruby/ruby-2.1.2/bin/passenger-install-apache2-module
  <span class="k">*</span> To <span class="nb">install </span>Apache 2 development headers:
  Please <span class="nb">install </span>it with apt-get <span class="nb">install </span>apache2-threaded-dev

  <span class="k">*</span> To <span class="nb">install </span>Apache Portable Runtime <span class="o">(</span>APR<span class="o">)</span> development headers:
  Please <span class="nb">install </span>it with apt-get <span class="nb">install </span>libapr1-dev

  <span class="k">*</span> To <span class="nb">install </span>Apache Portable Runtime Utility <span class="o">(</span>APU<span class="o">)</span> development headers:
  Please <span class="nb">install </span>it with apt-get <span class="nb">install </span>libaprutil1-dev
</code></pre></div></div>

<p>言われるままにインストールする。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aptitude <span class="nb">install </span>apache2-threaded-dev libapr1-dev libaprutil1-dev

</code></pre></div></div>

<p>passengerモジュールをインストール。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>passenger-install-apache2-module
  apache2: Syntax error on line 140 of /etc/apache2/apache2.conf: Syntax error on line 1 of /etc/apache2/mods-enabled/passenger.load: Cannot load /opt/ruby/ruby-2.1.2/lib/ruby/gems/2.1.0/gems/passenger-4.0.45/buildout/apache2/mod_passenger.so into server: /opt/ruby/ruby-2.1.2/lib/ruby/gems/2.1.0/gems/passenger-4.0.45/buildout/apache2/mod_passenger.so: undefined symbol: unixd_config
  apache2: Syntax error on line 140 of /etc/apache2/apache2.conf: Syntax error on line 1 of /etc/apache2/mods-enabled/passenger.load: Cannot load /opt/ruby/ruby-2.1.2/lib/ruby/gems/2.1.0/gems/passenger-4.0.45/buildout/apache2/mod_passenger.so into server: /opt/ruby/ruby-2.1.2/lib/ruby/gems/2.1.0/gems/passenger-4.0.45/buildout/apache2/mod_passenger.so: undefined symbol: unixd_config
  Your Apache installation might be broken
</code></pre></div></div>

<p>なぜかビルド出来ない。調べてみると unixd_config は ap_unixd_config にリネームされたらしいが、決定的な情報が出てこず、ハマる。悩む。<br />
で、よーーーーーーーーく考えてみると、passenger.load でエラーが出ているけど、新しい passenger 入れるんだからいらんだろ！ということで、passenger.load と passenger.conf の中身をコメントアウトしたらビルド通った。</p>

<h2 id="redmine">Redmine</h2>

<p><a href="http://blog.mkt-sys.jp/2014/05/rmagick-reinstall.html">前回のアップグレードでは、RMagicがおかしなことになっていた</a>ので、確認してみる。
RMagic とか Redmine 以前に、<code class="highlighter-rouge">ERR_SSL_PROTOCOL_ERROR</code> とか言われて接続できていないんですけどー。
<code class="highlighter-rouge">/etc/apache2/sites-available/default-ssl.conf</code> から <code class="highlighter-rouge">/etc/apache2/sites-enabled/000-default-ssl.conf</code> とかシンボリックリンクを貼ると Redmine ではなくデフォルトページだが表示されるので、Redmine 用の設定が読み込まれていないっぽい。
調べてみると <a href="http://askubuntu.com/questions/450722/why-not-work-apache-virtual-hosts-on-ubuntu-14-04">server - Why not work Apache virtual hosts on Ubuntu 14.04? - Ask Ubuntu</a> がヒット。
Apache2.4から <code class="highlighter-rouge">.conf</code> 拡張子が必要になったらしい。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">rm</span> /etc/apache2/sites-enabled/001-redmine
<span class="nv">$ </span><span class="nb">mv</span> /etc/apache2/sites-available/redmine<span class="o">{</span>,.conf<span class="o">}</span>
<span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> /etc/apache2/sites-available/redmine.conf /etc/apache2/sites-enabled/001-redmine.conf
<span class="nv">$ </span>service apache2 restart
  AH00548: NameVirtualHost has no effect and will be removed <span class="k">in </span>the next release /etc/apache2/sites-enabled/001-redmine.conf:1
</code></pre></div></div>

<p>ちゃんと読み込まれたらしい。警告が出たので、対応もした。</p>

<p>再度アクセスしたら、今度は <code class="highlighter-rouge">You don't have permission to access / on this server.</code> とか言われる。今まではこれで動いとってん！
<code class="highlighter-rouge">/var/log/apache2/error.log</code> には <code class="highlighter-rouge">AH01630: client denied by server configuration: /var/lib/rails/redmine/public</code> と出力されている。
<code class="highlighter-rouge">redmine.conf</code> にパーミッション設定をすればよさげ。</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;<span class="n">VirtualHost</span> *:<span class="m">443</span>&gt;
  <span class="n">ServerName</span> <span class="n">xxx</span>.<span class="n">mkt</span>-<span class="n">sys</span>.<span class="n">jp</span>:<span class="m">443</span>
  <span class="n">DocumentRoot</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">rails</span>/<span class="n">redmine</span>/<span class="n">public</span>
  &lt;<span class="n">Directory</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">rails</span>/<span class="n">redmine</span>/<span class="n">public</span>/&gt;
    <span class="n">Options</span> <span class="n">FollowSymLinks</span>
    <span class="n">AllowOverride</span> <span class="n">None</span>
    <span class="n">Order</span> <span class="n">allow</span>,<span class="n">deny</span>
    <span class="n">Allow</span> <span class="n">from</span> <span class="n">all</span>
  &lt;/<span class="n">Directory</span>&gt;
  <span class="n">SSLCertificateFile</span>/<span class="n">etc</span>/<span class="n">apache2</span>/<span class="n">cert</span>/<span class="n">ssl</span>-<span class="n">cert</span>.<span class="n">pem</span>
  <span class="n">SSLCertificateKeyFile</span> /<span class="n">etc</span>/<span class="n">apache2</span>/<span class="n">cert</span>/<span class="n">ssl</span>-<span class="n">cert</span>.<span class="n">key</span>
  <span class="n">PassengerEnabled</span> <span class="n">on</span>
&lt;/<span class="n">VirtualHost</span>&gt;

</code></pre></div></div>

<p>しかし、これでも動かない。わけわからん。
ここで再びネットの海を彷徨い <a href="http://blog.netandfield.com/shar/2012/10/24-htaccess.html">おほ。2.4系じゃ .htaccess ファイルの許可の仕方も変わってるんだなあ - 電気ウナギ的○○</a> を発見する。</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;<span class="n">VirtualHost</span> *:<span class="m">443</span>&gt;
  <span class="n">ServerName</span> <span class="n">xxx</span>.<span class="n">mkt</span>-<span class="n">sys</span>.<span class="n">jp</span>:<span class="m">443</span>
  <span class="n">DocumentRoot</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">rails</span>/<span class="n">redmine</span>/<span class="n">public</span>
  &lt;<span class="n">Directory</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">rails</span>/<span class="n">redmine</span>/<span class="n">public</span>/&gt;
    <span class="n">Options</span> <span class="n">FollowSymLinks</span>
    <span class="n">AllowOverride</span> <span class="n">None</span>
    <span class="n">Require</span> <span class="n">all</span> <span class="n">granted</span>
  &lt;/<span class="n">Directory</span>&gt;
  <span class="n">SSLCertificateFile</span>/<span class="n">etc</span>/<span class="n">apache2</span>/<span class="n">cert</span>/<span class="n">ssl</span>-<span class="n">cert</span>.<span class="n">pem</span>
  <span class="n">SSLCertificateKeyFile</span> /<span class="n">etc</span>/<span class="n">apache2</span>/<span class="n">cert</span>/<span class="n">ssl</span>-<span class="n">cert</span>.<span class="n">key</span>
  <span class="n">PassengerEnabled</span> <span class="n">on</span>
&lt;/<span class="n">VirtualHost</span>&gt;
</code></pre></div></div>

<p>とせんとイカンらしい。これでようやくRedmineが表示された。</p>

<h2 id="imagemagickとrmagick">ImageMagickとRMagick</h2>

<p>Redmineを確認すると案の定下記の ImageMagick 関連がエラーになっていた。</p>

<ul>
  <li>RMagickが利用可能 (オプション)</li>
  <li>ImageMagickのconvertコマンドが利用可能 (オプション)</li>
  <li>前回の用にソースから再度ビルドしてもいいのだが、どうやら apt に入っている ImageMagick も新しくなって、RMagick をすんなり入れられるらしいので、入れ替える。</li>
</ul>

<p><code class="highlighter-rouge">/usr/bin</code> から ImageMagick 関連のシンボリックリンクを削除した後に ImageMagick と RMagick を入れ替える。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aptitude <span class="nb">install </span>imagemagick libmagick++-dev
<span class="nv">$ </span><span class="nb">cd</span> /var/lib/rails/redmine
<span class="nv">$ </span>bundle <span class="nb">exec </span>gem uninstall rmagick
<span class="nv">$ </span>bundle <span class="nb">install</span>

</code></pre></div></div>

<p>これで、”ImageMagickのconvertコマンドが利用可能 (オプション)” は解決。
RMagick については <a href="http://blog.mkt-sys.jp/2014/05/fix-rmagick.html">以前の経験</a>により調査する。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>rails c production
irb<span class="o">(</span>main<span class="o">)</span>:001:0&gt; require <span class="s1">'RMagick'</span>
  LoadError: liblcms.so.1: cannot open shared object file: No such file or directory - /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/extensions/x86_64-linux/2.1.0-static/rmagick-2.13.2/RMagick2.so
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in <span class="sb">`</span>require<span class="s1">'
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in `block in require'</span>
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:236:in <span class="sb">`</span>load_dependency<span class="s1">'
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in `require'</span>
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/rmagick-2.13.2/lib/RMagick.rb:11:in <span class="sb">`</span>&lt;top <span class="o">(</span>required<span class="o">)&gt;</span><span class="s1">'
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in `require'</span>
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in <span class="sb">`</span>block <span class="k">in </span>require<span class="s1">'
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:236:in `load_dependency'</span>
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/activesupport-3.2.19/lib/active_support/dependencies.rb:251:in <span class="sb">`</span>require<span class="s1">'
  from (irb):1
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/railties-3.2.19/lib/rails/commands/console.rb:47:in `start'</span>
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/railties-3.2.19/lib/rails/commands/console.rb:8:in <span class="sb">`</span>start<span class="s1">'
  from /var/lib/rails/redmine-2.5.2/vendor/bundle/ruby/2.1.0/gems/railties-3.2.19/lib/rails/commands.rb:41:in `&lt;top (required)&gt;'</span>
  from script/rails:6:in <span class="sb">`</span>require<span class="s1">'
  from script/rails:6:in `&lt;main&gt;'</span>
</code></pre></div></div>

<p>liblcms.so.1 が見つからないらしい。locate しても確かにいない。
apt で入れたのに、ライブラリ足りないってどーゆーことよ。
依存関係を調べてみる。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ldd vendor/bundle/ruby/2.1.0/gems/rmagick-2.13.2/lib/RMagick2.so
  linux-vdso.so.1 <span class="o">=&gt;(</span>0x00007fff01ffe000<span class="o">)</span>
  libMagickCore.so.5 <span class="o">=&gt;</span> /usr/local/lib/libMagickCore.so.5 <span class="o">(</span>0x00007f6be578c000<span class="o">)</span>
  libpthread.so.0 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libpthread.so.0 <span class="o">(</span>0x00007f6be556e000<span class="o">)</span>
  libm.so.6 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libm.so.6 <span class="o">(</span>0x00007f6be5267000<span class="o">)</span>
  libc.so.6 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libc.so.6 <span class="o">(</span>0x00007f6be4ea1000<span class="o">)</span>
  liblcms.so.1 <span class="o">=&gt;</span> not found
  libtiff.so.4 <span class="o">=&gt;</span> not found
  libfreetype.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libfreetype.so.6 <span class="o">(</span>0x00007f6be4bfd000<span class="o">)</span>
  libjasper.so.1 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libjasper.so.1 <span class="o">(</span>0x00007f6be49a6000<span class="o">)</span>
  libjpeg.so.62 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libjpeg.so.62 <span class="o">(</span>0x00007f6be4780000<span class="o">)</span>
  libpng12.so.0 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libpng12.so.0 <span class="o">(</span>0x00007f6be455a000<span class="o">)</span>
  libXext.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libXext.so.6 <span class="o">(</span>0x00007f6be4348000<span class="o">)</span>
  libSM.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libSM.so.6 <span class="o">(</span>0x00007f6be413f000<span class="o">)</span>
  libICE.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libICE.so.6 <span class="o">(</span>0x00007f6be3f23000<span class="o">)</span>
  libX11.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libX11.so.6 <span class="o">(</span>0x00007f6be3bee000<span class="o">)</span>
  libbz2.so.1.0 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libbz2.so.1.0 <span class="o">(</span>0x00007f6be39dd000<span class="o">)</span>
  libxml2.so.2 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libxml2.so.2 <span class="o">(</span>0x00007f6be3677000<span class="o">)</span>
  libz.so.1 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libz.so.1 <span class="o">(</span>0x00007f6be345e000<span class="o">)</span>
  libgomp.so.1 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libgomp.so.1 <span class="o">(</span>0x00007f6be324e000<span class="o">)</span>
  libltdl.so.7 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libltdl.so.7 <span class="o">(</span>0x00007f6be3044000<span class="o">)</span>
  libdl.so.2 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libdl.so.2 <span class="o">(</span>0x00007f6be2e40000<span class="o">)</span>
  /lib64/ld-linux-x86-64.so.2 <span class="o">(</span>0x00007f6be607c000<span class="o">)</span>
  libjpeg.so.8 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libjpeg.so.8 <span class="o">(</span>0x00007f6be2bea000<span class="o">)</span>
  libuuid.so.1 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/libuuid.so.1 <span class="o">(</span>0x00007f6be29e5000<span class="o">)</span>
  libxcb.so.1 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libxcb.so.1 <span class="o">(</span>0x00007f6be27c5000<span class="o">)</span>
  liblzma.so.5 <span class="o">=&gt;</span> /lib/x86_64-linux-gnu/liblzma.so.5 <span class="o">(</span>0x00007f6be25a3000<span class="o">)</span>
  libXau.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libXau.so.6 <span class="o">(</span>0x00007f6be239e000<span class="o">)</span>
  libXdmcp.so.6 <span class="o">=&gt;</span> /usr/lib/x86_64-linux-gnu/libXdmcp.so.6 <span class="o">(</span>0x00007f6be2198000<span class="o">)</span>
</code></pre></div></div>

<p>なんと <code class="highlighter-rouge">liblcms.so.1</code> だけでなく、<code class="highlighter-rouge">libtiff.so.4</code> も見つからないらしい。おろろーん。
aptitude でみてみると libtiff5 や libcmls2 は入っている。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lrwxrwxrwx 1 root root 17 Jan 162014 /usr/lib/x86_64-linux-gnu/liblcms2.so -&gt; liblcms2.so.2.0.5
lrwxrwxrwx 1 root root 17 Jan 162014 /usr/lib/x86_64-linux-gnu/liblcms2.so.2 -&gt; liblcms2.so.2.0.5
-rw-r--r-- 1 root root 346928 Jan 162014 /usr/lib/x86_64-linux-gnu/liblcms2.so.2.0.5
# 省略
lrwxrwxrwx 1 root root 16 May6 04:39 /usr/lib/x86_64-linux-gnu/libtiff.so -&gt; libtiff.so.5.2.0
lrwxrwxrwx 1 root root 16 May6 04:39 /usr/lib/x86_64-linux-gnu/libtiff.so.5 -&gt; libtiff.so.5.2.0
-rw-r--r-- 1 root root 467208 May6 04:39 /usr/lib/x86_64-linux-gnu/libtiff.so.5.2.0
</code></pre></div></div>

<p>ライブラリのファイルもあるので、多少バージョンが違うかもしれないが強引にこれらにリンクさせてみる。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /usr/lib/x86_64-linux-gnu/
<span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> liblcms2.so liblcms.so.1
<span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> libtiff.so.5 libtiff.so.4

</code></pre></div></div>

<p>Redmine を再起動して確認してみると、”ImageMagickのconvertコマンドが利用可能 (オプション)” もOKマークに変わっている。
念のため、動かしてみる。
Redmine では、RMagick はガントチャートの PNG のために使用されているので、PNG 表示してみると無事に表示されたが、日本語が文字化けした。
<a href="http://redmine.jp/faq/gantt/gantt-png-mojibake/">ガントチャートをPNG形式の画像に出力すると文字化けする — Redmine.JP</a> によると、日本語フォントを設定しないといけないらしい。
そもそもインストールしていないのでインストールして設定する。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aptitude <span class="nb">install </span>fonts-ipaexfont
<span class="nv">$ </span>vim /var/lib/rails/redmine/config/configration.yml
  <span class="c">#=&gt; rmagick_font_path に /usr/share/fonts/truetype/fonts-japanese-gothic.ttf を指定</span>
</code></pre></div></div>

<p>するとすんなり PNG でも日本語が表示された。
ということで、とりあえず問題は解決したと思われる。
しかし、もっと本質的な解決方法があると思うなぁ、でも疲れたので今回はここまで。
前回より苦戦しないかと思ったらとんでもない、ドはまりしてだいぶ時間がかかった。</p>

  </div><a class="u-url" href="/2014/09/11/upgrade-ubuntu-to-1404-on-sakura-vps.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">tail -f pinzo.log</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">tail -f pinzo.log</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/pinzolo"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">pinzolo</span></a></li><li><a href="https://www.twitter.com/pinzolo"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">pinzolo</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>pinzolo の技術系 blog</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
