---
layout: default
title: タグ一覧
---

<main class="main-content container">
  {% raw %}
  <div id="app">
    <div class="field">
      <p class="control has-icons-left">
        <input
          class="input"
          type="text"
          placeholder="Search"
          v-model="searchText"
        />
        <span class="icon is-small is-left">
          <i class="fas fa-search"></i>
        </span>
      </p>
    </div>

    <nav class="panel" v-for="tag in filtered" :key="tag.tag">
      <p class="panel-heading">
        <span class="icon">
          <i class="fas fa-tag"></i>
        </span>
        {{ tag.tag }} ({{ tag.posts.length }})
      </p>
      <a
        class="panel-block"
        v-for="post in tag.posts"
        :key="post.url"
        :href="post.url"
      >
        <span class="panel-icon">
          <i class="fas fa-angle-right" aria-hidden="true"></i>
        </span>
        {{ post.title }}
      </a>
    </nav>
  </div>
  {% endraw %}
</main>
<script>
  new Vue({
    el: '#app',
    computed: {
      tagSet: function() {
        var ps = this.posts;
        return this.tags.map(function(tag) {
          return {
            tag: tag,
            posts: ps.filter(function(post) {
              return post.tags.includes(tag);
            })
          };
        });
      },
      filtered: function() {
        var txt = this.searchText;
        return this.tagSet.filter(function(tag, i) {
          if (!txt) {
            return true;
          }
          return tag.tag.includes(txt);
        });
      }
    },
    data: function() {
      return {
        loading: false,
        searchText: '',
        tags: [],
        posts: []
      };
    },
    mounted: function() {
      var query = window.location.search;
      if (query) {
        var tag = query
          .slice(1)
          .split('&')
          .map(function(e) {
            return e.split('=');
          })
          .find(function(e) {
            return e[0] === 'tag';
          });
        if (tag) {
          this.searchText = tag[1];
        }
      }
      (function(self) {
        axios.get("{{ '/tags.json' | relative_url }}").then(function(res) {
          self.tags = res.data;
        });
      })(this);
      (function(self) {
        axios.get("{{ '/index.json' | relative_url }}").then(function(res) {
          self.posts = res.data;
        });
      })(this);
    }
  });
</script>
